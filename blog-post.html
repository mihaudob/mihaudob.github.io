<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post - Michal Dobiecki</title>

    <!-- favicon -->
    <link rel="shortcut icon" href="./assets/images/logo.ico"
      type="image/x-icon">

    <!-- custom css link -->
    <link rel="stylesheet" href="./assets/css/style.css">

    <!-- google font link -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet">

    <!-- marked.js for markdown parsing -->
    <script
      src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>

    <style>
    .blog-post-content {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .blog-post-header {
      margin-bottom: 40px;
    }

    .blog-post-header h1 {
      color: var(--white-2);
      font-size: 2.5rem;
      margin-bottom: 20px;
      line-height: 1.3;
    }

    .blog-post-meta {
      display: flex;
      gap: 20px;
      color: var(--light-gray);
      font-size: var(--fs-6);
      margin-bottom: 10px;
    }

    .blog-post-meta span {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .back-to-blog {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      color: var(--orange-yellow-crayola);
      text-decoration: none;
      font-size: var(--fs-6);
      margin-bottom: 30px;
      transition: var(--transition-1);
    }

    .back-to-blog:hover {
      color: var(--vegas-gold);
    }

    .markdown-content {
      color: var(--light-gray);
      line-height: 1.8;
    }

    .markdown-content h1,
    .markdown-content h2,
    .markdown-content h3,
    .markdown-content h4 {
      color: var(--white-2);
      margin-top: 30px;
      margin-bottom: 15px;
    }

    .markdown-content h2 {
      font-size: 1.8rem;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--jet);
    }

    .markdown-content h3 {
      font-size: 1.4rem;
    }

    .markdown-content p {
      margin-bottom: 15px;
    }

    .markdown-content ul,
    .markdown-content ol {
      margin-left: 0;
      margin-bottom: 20px;
      padding-left: 40px;
      list-style-position: outside !important;
    }

    .markdown-content ol,
    .markdown-content ol li {
      list-style: decimal !important;
      list-style-type: decimal !important;
    }

    .markdown-content ul,
    .markdown-content ul li {
      list-style: disc !important;
      list-style-type: disc !important;
    }

    .markdown-content li {
      margin-bottom: 10px;
      color: var(--light-gray);
      display: list-item !important;
      margin-left: 0 !important;
      padding-left: 0 !important;
    }

    .markdown-content ol > li {
      list-style: decimal !important;
    }

    .markdown-content ul > li {
      list-style: disc !important;
    }

    .markdown-content li::marker {
      color: var(--orange-yellow-crayola);
      font-size: 1em;
    }

    .markdown-content code {
      background: var(--eerie-black-1);
      border: 1px solid var(--jet);
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: var(--orange-yellow-crayola);
    }

    .markdown-content pre {
      background: var(--eerie-black-1);
      border: 1px solid var(--jet);
      border-radius: 8px;
      padding: 20px;
      overflow-x: auto;
      margin: 20px 0;
    }

    .markdown-content pre code {
      background: none;
      border: none;
      padding: 0;
      color: var(--light-gray);
    }

    .markdown-content blockquote {
      border-left: 4px solid var(--orange-yellow-crayola);
      padding-left: 20px;
      margin: 20px 0;
      color: var(--light-gray-70);
      font-style: italic;
    }

    .markdown-content a {
      color: var(--orange-yellow-crayola);
      text-decoration: none;
      transition: var(--transition-1);
    }

    .markdown-content a:hover {
      color: var(--vegas-gold);
      text-decoration: underline;
    }

    .markdown-content img {
      max-width: 100%;
      border-radius: 8px;
      margin: 20px 0;
    }

    .markdown-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    .markdown-content th,
    .markdown-content td {
      border: 1px solid var(--jet);
      padding: 12px;
      text-align: left;
    }

    .markdown-content th {
      background: var(--eerie-black-1);
      color: var(--white-2);
    }

    .markdown-content strong {
      color: var(--white-2);
      font-weight: 600;
    }

    /* Light theme overrides */
    body.light-theme {
      background: #fafafa;
    }

    body.light-theme .blog-post-content {
      background: transparent;
    }

    body.light-theme .blog-post-header h1,
    body.light-theme .markdown-content h1 {
      color: #1a1a1a;
    }

    body.light-theme .markdown-content h2 {
      color: #2a2a2a;
      border-bottom-color: #e0e0e0;
    }

    body.light-theme .markdown-content h3,
    body.light-theme .markdown-content h4 {
      color: #3a3a3a;
    }

    body.light-theme .markdown-content strong {
      color: #1a1a1a;
    }

    body.light-theme .markdown-content,
    body.light-theme .markdown-content p,
    body.light-theme .markdown-content li {
      color: #333;
    }

    body.light-theme .markdown-content ol,
    body.light-theme .markdown-content ol li {
      list-style: decimal !important;
      list-style-type: decimal !important;
    }

    body.light-theme .markdown-content ul,
    body.light-theme .markdown-content ul li {
      list-style: disc !important;
      list-style-type: disc !important;
    }

    body.light-theme .markdown-content li {
      display: list-item !important;
    }

    body.light-theme .markdown-content ol > li {
      list-style: decimal !important;
    }

    body.light-theme .markdown-content ul > li {
      list-style: disc !important;
    }

    body.light-theme .markdown-content li::marker {
      color: #d96846;
    }

    body.light-theme .markdown-content pre {
      background: #f5f5f5;
      border-color: #e0e0e0;
    }

    body.light-theme .markdown-content code {
      background: #f0f0f0;
      border-color: #e0e0e0;
      color: #d73a49;
    }

    body.light-theme .markdown-content pre code {
      color: #333;
      background: transparent;
    }

    body.light-theme .markdown-content th {
      background: #f5f5f5;
      color: #1a1a1a;
    }

    body.light-theme .markdown-content td {
      color: #333;
    }

    body.light-theme .markdown-content a {
      color: #d96846;
    }

    body.light-theme .markdown-content blockquote {
      border-left-color: #d96846;
      color: #555;
    }

    body.light-theme .back-to-blog {
      color: #d96846;
    }

    body.light-theme .back-to-blog:hover {
      color: #596235;
    }

    body.light-theme .blog-post-meta {
      color: #666;
    }

    /* Theme toggle button */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--eerie-black-2);
      border: 1px solid var(--jet);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-1);
      z-index: 100;
    }

    .theme-toggle:hover {
      background: var(--bg-gradient-yellow-1);
      transform: scale(1.1);
    }

    .theme-toggle ion-icon {
      font-size: 24px;
      color: var(--orange-yellow-crayola);
    }

    .theme-toggle:hover ion-icon {
      color: var(--eerie-black-1);
    }

    body.light-theme .theme-toggle {
      background: linear-gradient(135deg, rgba(217, 104, 70, 0.1), rgba(89, 98, 53, 0.1));
      border-color: rgba(217, 104, 70, 0.4);
    }

    body.light-theme .theme-toggle:hover {
      background: var(--bg-gradient-yellow-1);
    }

    body:not(.light-theme) .theme-toggle {
      background: linear-gradient(135deg, rgba(217, 104, 70, 0.15), rgba(89, 98, 53, 0.12));
      border-color: rgba(217, 104, 70, 0.4);
    }

    /* Loading state */
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--light-gray);
    }

    .loading::after {
      content: "...";
      animation: dots 1.5s infinite;
    }

    @keyframes dots {
      0%, 20% { content: "."; }
      40% { content: ".."; }
      60%, 100% { content: "..."; }
    }
  </style>
  </head>

  <body>

    <!-- Theme toggle button -->
    <button class="theme-toggle" data-theme-toggle aria-label="Toggle theme">
      <ion-icon name="moon-outline"></ion-icon>
    </button>

    <main>
      <div class="blog-post-content">
        <a href="./index.html#blog" class="back-to-blog">
          <ion-icon name="arrow-back-outline"></ion-icon>
          Back to Blog
        </a>

        <div id="blog-post">
          <div class="loading">Loading blog post</div>
        </div>
      </div>
    </main>

    <!-- ionicon link -->
    <script type="module"
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <script>
    'use strict';

    // Theme handling (same as main site)
    const currentTheme = localStorage.getItem('theme') || 'light-theme';
    document.body.classList.add(currentTheme);

    // Theme toggle functionality
    const themeToggleBtn = document.querySelector("[data-theme-toggle]");
    if (themeToggleBtn) {
      themeToggleBtn.addEventListener("click", function () {
        document.body.classList.toggle("light-theme");

        if (document.body.classList.contains("light-theme")) {
          localStorage.setItem('theme', 'light-theme');
        } else {
          localStorage.setItem('theme', 'dark-theme');
        }
      });
    }

    // Get blog post slug from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const postSlug = urlParams.get('post');

    if (!postSlug) {
      document.getElementById('blog-post').innerHTML = `
        <div class="error">
          <h1>Blog post not found</h1>
          <p>Please select a blog post from the <a href="./index.html#blog">blog page</a>.</p>
        </div>
      `;
    } else {
      // Fetch and render the markdown file
      console.log('Fetching blog post:', postSlug);
      fetch(`./blog/${postSlug}.md`)
        .then(response => {
          console.log('Fetch response status:', response.status);
          if (!response.ok) {
            throw new Error(`Blog post not found (HTTP ${response.status})`);
          }
          return response.text();
        })
        .then(markdown => {
          console.log('Markdown loaded, length:', markdown.length);
          // Check if marked is available
          if (typeof marked === 'undefined') {
            throw new Error('Marked.js library not loaded');
          }
          // Parse the markdown
          const html = marked.parse(markdown);
          console.log('Markdown parsed successfully');

          // Extract title and meta information
          const lines = markdown.split('\n');
          const title = lines[0].replace(/^#\s+/, '');

          // Find published date and category
          let published = '';
          let category = '';
          for (let line of lines) {
            if (line.includes('**Published:**')) {
              published = line.replace('**Published:**', '').trim();
            }
            if (line.includes('**Category:**')) {
              category = line.replace('**Category:**', '').trim();
            }
          }

          // Update page title
          document.title = `${title} - Michal Dobiecki`;

          // Render the blog post
          document.getElementById('blog-post').innerHTML = `
            <div class="blog-post-header">
              <div class="blog-post-meta">
                ${category ? `<span><ion-icon name="folder-outline"></ion-icon>${category}</span>` : ''}
                ${published ? `<span><ion-icon name="calendar-outline"></ion-icon>${published}</span>` : ''}
              </div>
            </div>
            <div class="markdown-content">
              ${html}
            </div>
          `;
        })
        .catch(error => {
          document.getElementById('blog-post').innerHTML = `
            <div class="error">
              <h1>Error Loading Blog Post</h1>
              <p><strong>Error:</strong> ${error.message}</p>
              <p>Sorry, we couldn't load this blog post. This might be because:</p>
              <ul style="text-align: left; margin: 20px auto; max-width: 500px;">
                <li>You're viewing this locally (use a web server or GitHub Pages)</li>
                <li>The markdown file doesn't exist</li>
                <li>There's a network issue</li>
              </ul>
              <p><a href="./index.html">Return to blog</a></p>
            </div>
          `;
          console.error('Error loading blog post:', error);
          console.error('Post slug:', postSlug);
          console.error('Attempted URL:', './blog/' + postSlug + '.md');
        });
    }
  </script>

  </body>

</html>
